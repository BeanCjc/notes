# 网络知识
## 1.提纲

### 1.1什么是Internet

层次性结构是网络结构的基础，下层为上层提供服务，上层完善整个网络结构
应用层交换应用报文，实现各种各样的应用。http协议、ftp协议等各种协议
传输层完成进程到进程的可靠传输，传输tcp/udp协议报文
网络层完成端到端（主机到主机）的不可靠传输，传输ip数据报（ip协议），路由器（R），防火墙
数据链路层完成点到点（比如交换机到交换机等）的传输，传输帧，网卡、交换机（sw）
物理层将0、1数据和物理信号（光信号、电信号等）之间相互转换并传输

从构成的角度来说，互联网：节点和边
节点：主机节点、数据交换节点（中继器、交换机、路由器）
边：接入的链路、骨干链路、协议
协议：对等层的实体，在通信的过程中应该遵守的规则的集合，协议定义了在两个或多个通信实体之间交换的报文格式（语法、语义）和次序，以及在报文传输或接收或其他事件方面所采取的动作

从服务的角度来说，互联网可以是分布式应用进程和为分布式应用提供通信的基础设施（应用层以下所有）
基础设施通过面向连接的可靠服务或者面向无连接的不可靠服务对外（应用）提供服务

### 1.2网络边缘

### 1.3网络核心

两种数据传输方式：线路交换和分组交换

### 1.4接入网和物理媒介

### 1.5Internet结构和ISP（Internet Service Providers）

### 1.6分组延时、丢失和吞吐量

延时：排队延时、处理延时（查路由表）（微妙级甚至更少）、传输延时（带宽）（微秒级到毫秒级）、传播延时（距离）（几微秒到击败毫秒 ）

两个路由之间称为一跳（hop）

TTL（生存时间）：Time To Live

RTT（往返时间）：Round Trip Time

丢失：链路的队列缓冲区容量有限，丢失的分组可能由上一跳重传（链路层可靠），可能由源主机重传（Tcp未收到应答信号），也可能不重传（UDP）

吞吐量：在源端和目标端之间传输的速率，数据量/单位时间，源端发出到目标端接收到有效的数据，吞吐量的大小取决于网络核心中有效带宽（链路可能同时被多个链接使用）最小的那一跳

瞬时吞吐量：在一个时间点的速率

平均吞吐量：在一个长时间内平均值

### 1.7协议层次和服务模型

层次化方式实现复杂的计算机网络
每层通过层间接口向上层提供服务，实现更复杂的服务，最终实现计算机网络，层的目的是向上层提供更好的服务，层的实现是通过层间接口调用下层提供的服务。

服务：低层实体向上层实体提供他们之间的通信的能力

- 服务用户
- 服务提供者

原语（primitive）：上层使用下层服务的形式，高层使用低层提供的服务，以及低层向高层提供服务都是通过服务访问原语来进行监护的---形式

服务访问点SAP（Service Access Point）：上层使用低层服务时，低层服务区分上层服务（上层使用下层提供的服务通过层间的接口--地点）

数据单元（DU：Data Unit）

服务数据单元（SDU：Service Data Unit）

协议数据单元（PDU：Protocol Data Unit）

本层的接口控制信息（ICI：Interface Control Information）

每层的PDU称呼都不同
应用层叫应用报文（message），传输层叫报文段（segment），网络层叫分组（package）/IP数据报（datagram）、数据链路层叫帧（frame），物理层叫位（bit）

Internet协议栈

- 应用层：网络应用，FTP、SMTP、HTTP、DNS
- 传输层：跨主机间进程传输，TCP、UDP
- 网络层：主机间的通信，端到端的通信，不可靠，IP协议、路由协议
- 链路层：相邻网络节点间的数据传输，点到点通信，点对点协议PPP、802.11（wifi），Ethernet
- 物理层：在线路上传送bit



## 2.应用层

### 2.1应用层协议原理

寻址：协议（TCP/UDP）、IP、端口

传输层和应用层如何传输数据

进程间使用传输层的服务，实现应用进程的协议

tcp socket指的是会话关系，包含源IP、源端口、目的IP和目的端口，传输报文时发送socket标识、数据

udp socket包含本地IP，本地端口，传输报文时发送socket标识、目的IP、目的端口、数据

### 2.2Web and Http

URL格式：protocol://user:password@hostname/route:port
协议名 用户：口令 主机名 路径名 端口

HTTP：超文本传输协议，是无状态协议，默认端口80
HTTP 1.0：RFC 1945
HTTP 1.1：RFC 2068
http1.0使用非持久连接，http1.1默认使用持久连接，多个对象可以在一个tcp连接上传输	

http报文类型：请求，响应

http请求报文：
- 请求行（get、post、head等，http1.1还增加put、delete等）：method url protocolVersion
- 首部行
- 换行回车符（表示报文结束）
- 实体数据

http响应报文：

- 状态行：protocolVersion statusCode statusCodeDescription
- 首部行
- 换行回车符
- 实体数据

cookie：维护状态，客户端第一次请求时，服务端在响应头中写入cookie并保存在服务端，客户端将响应的cookie保存；第二次客户端请求时，带上这些cookie，此时服务端就能收到客户端发过来的cookie

### 2.3FTP

FTP：文件传输协议，RFC959，服务端默认端口21（带外传送命令），客户端默认端口20（带内传输数据），有状态协议

### 2.4Email

三个主要组成部分：

- 用户代理，一般是客户端软件，比如outlook，foxmail
- 邮件服务器
- 简单邮件传输协议SMTP（发送的协议），POP3（Post Office Protocol）、IMAP（Internet mail access protocol）、http等（拉取的协议）

SMTP：简单邮件传输协议，RFC2821，服务端默认端口25，使用持久连接
直接传输：从发送方邮件服务器发送到目标邮件服务器
传输过程：

- tcp建立，握手

- 传输报文
- 关闭连接

报文为7位ASCII码

报文格式：

- 首部行，To、From、Subject、cc（抄送）
- 换行回车符
- 主体，报文，只能是ASCII

报文格式：多媒体编码

MIME（multimedia mail extension），RFC 2045，2056

整体的流程是：发送方用户代理通过SMTP推送-->发送方邮件服务器，再通过SMTP推送-->接收方邮件服务器-->接收方用户代理通过POP3/IMAP拉取邮件

IMAP协议更丰富，更复杂